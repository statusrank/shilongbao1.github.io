---
title: 深度学习----人脸识别(FaceRecognition)
copyright: true
mathjax: true
tags: 人脸识别
categories: 深度学习
abbrlink: '26274136'
date: 2018-10-15 20:38:03
updated:
---
##什么是人脸识别?
人脸识别包括人脸验证和人脸识别。
###人脸验证
输入:图片、名字/ID
输出:输入的图片是否是对应的人。
**是一个1到1的问题**
###人脸识别
你拥有一个K个人的数据库,输入一张人脸图片,如果图片是任意K位中的一个,则输出对应ID。
<!--more-->
人脸识别问题对于人脸验证问题来说,具有更高的难度。如对于一个验证系统来说,如果我们拥有百分之九十九的准确度,那么这个验证系统已经有了很高的精度。但是假设在另外一个识别系统中,如果我们把这个验证系统应用在具有K个人的识别系统中,那么系统犯错误的机会就会变成K倍。所以如果我们想在识别系统中获得更高的精度,那么就需要得到一个更高精度的验证系统。
##One-shot Learning
** 对于大多数人脸识别系统都存在的一个问题就是one-shot learning.**
###什么是one-shot learning
对于一个人脸识别系统,我们需要**仅仅通过先前的一张人脸的图片或者说一个人脸的样例,就能够实现该人的识别**,那么这样的问题就是one-shot问题。说白了就是在我们的训练集中关于该人的照片或者人脸样例很少,但是我们依然要能够识别他。
对于存在于数据库中的人脸图片,系统能够识别对应的人,而不在数据库中的图片,系统无法给出识别结果。
{%asset_img 1.jpg %}
对于one-shot learning问题,因为只有单个样本,是不足以训练一个稳健的(robust)的卷积神经网络来进行不同人的识别过程。而且,在有新的样本成员加入的时候,我们不可能还再去对网络进行重新训练。所以我们不能使用传统的方法来实现识别系统。
###Similarity函数
**为了能够让人脸识别系统实现一次学习,需要让神经网络学习Similarity函数。**
定义$d(img1,img2)$为两幅图片之间的差异程度 (输入两幅图片,输出d差异度)
如果 $d(img1,img2) <= t$,则认为两张图片相同(同一个人)
否则认为不同。
对于人脸识别系统,通过将输入的人脸图片与数据库中所拥有的图片成对输入Similarity函数,两两对比,则可解决one-shot learning问题。如果有新人加入也只需要将其照片添加进数据库。
##Siamese网络
**我们利用Siamese网络来实现Similarity函数。**
###构建网络
{%asset_img 2.jpg%}
对于一个卷积神经网络我们将其最后一层的softmax函数去掉,将图片x输入到网络中,最后由网络输入一个N维向量,记为$f(x)$。我们将其看成是图片x的编码$f(x)$，这个通过Siamese网络实现的。将不同的人的照片输入到相同参数的Siamese网络中就得到每个图片的编码。
###Similarity函数实现
将Similarity函数表示成两幅图片编码之差的范数。
$d(x_1,x_2) = ||f(x_1)-f(x_2)||^2$
由上面的公式可以得知:图片的编码f(x)是由Siamese网络的参数决定的,所以说学习网络的参数可以获得更高的Similarity函数值。
如果$x_1,x_2$是同一个人的照片,那么函数值应该尽可能小,否则应该尽可能大。
##Triplet损失
**像上面所说的,我们需要学习更好的网络参数,从而获得刚好的Similarity函数值。那么如何通过学习神经网络的参数,得到优质的人脸图片的编码。**按照以前,对于一个网络我们应该定义一个损失函数,然后应用梯度下降即可。**对于Siamese网络我们定义Triplet损失,然后应用梯度下降**。
###学习目标
为了使用Triplet损失函数,我们需要比较成对的图片（三元组术语）:
{% asset_img 3.jpg %}
对于Anchor和positive两张图片,我们希望他们二者的编码差异小一些；对于Anchore和negative我们希望编码差异大一些。
$d(A,P) = ||f(A) - f(P)||^2 <= d(A,N) = ||f(A) - f(N)||^2 $ 
也就是: $ ||f(A) - f(P)||^2 - ||f(A) - f(N)||^2 <= 0 $
**上面的公式存在问题,**也就是当$f(A)=f(P)=f(N)=0$ 时，也就是神经网络学习到的参数使得编码总为0时,或者$f(A)=f(P)=f(N) 时$，也满足上述公式,但这并不是我们想要的结果。为了防止这种情况,我们对上式修改,引入一个超参数,使得二者的差值小于一个较小的负数。
$ ||f(A) - f(P)||^2 - ||f(A) - f(N)||^2 <= -\alpha $
一般将 \alpha 写成 +\alpha ，称为“margin”，即：
$||f(A) - f(P)||^{2} - ||f(A) - f(N)||^{2} + \alpha \leqslant 0$
<font color = "red">不同的margin值的设置对模型学习具有不同的效果,margin的作用就是拉大了Anchor与positive对和Anchore与negative图片对之间的差异</font>
###Triplet损失函数
**Triplet 损失函数的定义基于三张图片：Anchor、Positive、Negative。**

$L(A,P,N) = \max (||f(A) - f(P)||^{2} - ||f(A) - f(N)||^{2} + \alpha, \ 0)$
整个网络的代价函数：

$J = \sum\limits_{i=1}^{m}L(A^{(i)},P^{(i)},N^{(i)})$
假设我们有一个10000张片的训练集，里面是1000个不同的人的照片样本。**我们需要做的就是从这10000张训练集中抽取图片生成（A,P,N）的三元组，来训练我们的学习算法，并在Triplet 损失函数上进行梯度下降。**
<font color = "red">为了训练我们的网络,我们必须拥有Anchor和Positive对,所以这里我们必须有每个人的多张照片,而不能仅仅是一张照片,否则无法训练网络.</font>
###(A,P,N)的选择
如果我们随机的选择三元组进行训练,可以发现我们的条件
$d(A,P) + \alpha \leqslant d(A,N)$是很容易满足的。
所以为了更好的训练网络,我们需要选择那么有难度的三元组,也就是那些
$d(A,P) \approx d(A,N)$.
这时候我们的算法会努力使得$d(A,N)$变大,使得$d(A,P)$变小,从而使得二者间最少有一个$\alpha$间隔。同时也能增加学习算法的效率,避免那些无效的三元组。
{%asset_img 4.jpg %}
##脸部验证与二分类
**除了利用Triplet损失函数来学习人脸识别卷积神经网络参数的方法外,我们还可以将人脸识别问题利用Siamese当成一个二分类问题,同样可以实现参数的学习。**
###Siamese二分类改进
对两张图片应用Siamese网络得到两张图片的编码,然后将两个编码输入到一个logistic regression单元中(如sigmoid函数),然后进行预测。如果是相同的人那么输出为1,如果是不同的那么输出为0.此时,我们便将一个人脸识别问题转化为一个二分类问题。
{%asset_img 5.jpg %}
对于最后的sigmoid函数，我们可以进行如下计算：

$\hat y = \sigma(\sum\limits_{k=1}^{N} w_{i}|f(x^{(i)})_{k} - f(x^{(j)})_{k} | + b)$
其中， f(x^{(i)}) 代表图片 x^{(i)} 的编码，下标 k 代表选择N维编码向量中的第 k 个元素。

我们以两个图片编码向量对应元素之间的差值作为特征输入到logistic regression 的单元中，增加参数$ w_i$ 和 $b$ ，通过训练得到合适的参数权重和偏置，进而判断两张图片是否为同一个人。
同时输入逻辑回归单元的特征可以进行更改，如还可以是：

$\dfrac{(f(x^{(i)})_{k} - f(x^{(j)})_{k})^{2}}{f(x^{(i)})_{k} + f(x^{(j)})_{k}}$
上式也被称为 $\chi$ 方公式，有时也称为 $\chi$ 方相似度。
<font color = "red">
在实际的人脸验证系统中，我们可以对数据库的人脸图片进行预计算，存储卷积网络得到的编码。当有图片进行识别时，运用卷积网络计算新图片的编码，与预计算保存好的编码输入到逻辑回归单元中进行预测。这样可以提高我们系统预测的效率，节省计算时间，同时数据库中也不必存那么多图片了。</font>
##总结
利用Siamese网络,我们可以将人脸验证作为一个监督学习,创建成对的训练集和是否是同一个人的输出标签。
{%asset_img 6.jpg %}

我们利用不同的图片对，使用反向传播的算法对Siamese网络进行训练，进而得到人脸验证系统。