---
title: 错排公式的几种求法
copyright: true
mathjax: true
tags: 错排公式
categories: 数学
abbrlink: 821f6b98
date: 2018-09-06 18:23:47
updated:
---
 错排问题，又称更列问题，是组合数学中的问题之一。最经典的问题就是:在写信时将n封信装到n个不同的信封里，有多少种全部装错信封的情况？再比如n个人各写一张贺卡相互赠送，有多少种赠送方法？这些经典的题目都是典型的错排问题。
<!--more-->
###递推公式:
先上错排公式$ f(n) = (n-1)(f(n-1) + f(n - 2)),f(1) = 0,f(2) = 1.$
下面来说一下它的推导:
假设我们现在有n封信,分别标号为$x_1,x_2,...x_n$,同时有n个信封为$y_1,y_2,y_3...y_n$.
设$f(n)$为n封信对应的错排数。那么首先对于第一封信$x_1$我们有$n-1$种放法。然后对于剩下的$n-1$封信我们分一下几种情况考虑:我们现在假设$x_1$放在$y_k$里,那么有:
1.$x_k$放在$y_1$里,那么可知此时剩下$n-2$ 封信的方法数为$f(n-2)$.
2.若$x_k$并没放在$y_1$里,那么此时我们可以将第k封信($x_k$)看成是$x_1$,这时候问题就转化为$n-1$封信放入n个信封,且都不能放入自己所对应的信封中的错排数,答案为$f(n-1)$。
综上,总的方法数即为$ f(n) = (n-1)(f(n-1) + f(n - 2))$
PS:对于第二种情况,我们之所以可以将$x_k$看成$x_1$，主要是此时$x_k$是不放在$y_1$中的,而n-1封信的错排中,第一封信时一定不放在第一个信封的。与此,二者问题是等价的。
###容斥求通项公式
[这个讲的还不错](https://www.cnblogs.com/zamhown/archive/2012/10/24/cpwt.html)
首先我们知道,这n个信封如果不存在错排条件的话一共有$n!$种放法。但是这时候就会对应出有一个放在自己的位置了,有两个放在自己的位置了...有n个..。
对于此,我们假设至少有一个是正确排列了,剩下$n-1$个全排列的方法数为: $C(n,1)(n-1)! $
要求错排,我们就要减去这种情况.但是此时发现我们把正好两个正确排列的多减去一次所以要加上$C(n,2)(n-2)!$，这是又把正好三个的多加一次...
最后得到公式为$
f(n) = n!-C(n,1)(n-1)!+C(n,2)(n-2)! -C(n,3)(n-3)! ..$
$f(n) = n!(1-\frac{1}{1!}+ \frac{1}{2!}-\frac{1}{3!} + \frac{1}{4!} ...\frac{(-1)^n}{n!})
$
###还有一种
$
f(n) = nf(n-1) + (-1)^n
$